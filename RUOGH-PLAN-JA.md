# Plan A – IPGO / OPE 2年マルチフェーズ粗案（Japanese Rough Plan）

## 概要

このロードマップは `ESTIMATION.md` をもとに、**2年間**で現実的に進められるマルチフェーズ計画を日本語でラフにまとめたものです。主な優先軸は：

- Wonder Festival / EXPO での**イベント運用対応**（WFブース申請、会場決済、リアルタイム連携など）
- IPGO / OPE 間の**共通基盤機能**（SSO、統合ダッシュボード、通知、マナ（ポイント）システム）
- ごく少人数チーム（開発者2名程度）を前提にした、**スコープを絞った進め方**
- 現行の **Directus / Spring Boot / Nuxt / React Native** スタックを基本的に継続しつつ、限界が見えたら後半で見直す

---

## 全体戦略（High-Level Strategy）

| 項目 | 方針 |
|------|------|
| スコープの現実性 | 2人前後のチームでは、48機能 + 14プロダクション項目すべては2年で完遂できない。**WF/EXPO・収益化・安定性**に絞る。 |
| バックエンド | 当面は **Spring Boot + Directus** を継続。Directus拡張が肥大化した場合のみ、後半でリライト／再設計を検討。 |
| リリーススタイル | 「WFブース申請 → セールス集計 → 会場マナ付与」といった **縦の細いスライス**で、こまめに本番リリースする。 |
| WFフォーカス | 世界展開よりもまずは **WFクラスのイベントを安定運用**できることを優先。運用手順・監視・復旧手順を重視。 |
| リスク管理 | 各フェーズ末に「Directusが限界か？」「Spring Bootで十分か？」を見直すチェックポイントを設ける。 |

---

## フェーズ0（0〜3ヶ月）：アラインメント・アーキテクチャ設計・最小限の基盤

### フェーズ0 サマリー

| 項目 | 内容 |
|------|------|
| 期間 | 0〜3ヶ月 |
| 主目的 | WF/EXPO優先方針の合意、SSO・マナ・WFモデルなどの**共通アーキテクチャ定義**、リスクの事前スパイク。 |
| 成果イメージ | ドメインモデルとシステム境界が明確になり、次フェーズ以降の実装が迷わない状態。 |

### 対象スコープ（`ESTIMATION.md` からの対応）

| # | 領域 | フェーズ0での扱い |
|---|------|--------------------|
| 1 | バグ修正 & UX改善 | 認証・WF関連画面に限定した優先度高いもののみ。 |
| 2 | 安定したSSO + ロール切替 | 実装前のアーキテクチャ設計とPoC。 |
| 3 | 統合ダッシュボード | 情報設計・ワイヤーフレーム・軽いプロトタイピング。 |
| 5 | 通知システム | 全体設計と技術スパイク。 |
| 36 | マナ（ポイント）システム | ドメインモデル・ルール・保存先を定義。実装は次フェーズ以降。 |

### 主な活動

| テーマ | 活動内容 |
|--------|----------|
| ドメイン & アーキテクチャ | User / Role / Session / Mana / Event(WF) / Booth / Product / Transaction のモデル定義と責務分担（Directus vs Spring Boot）。 |
| SSO & Identity 設計 | SSO方式（IdP、トークン形式、セッション構造、ロール切替フロー）を決める。 |
| リポジトリ & 環境 | IPGO / OPE 各リポジトリの構成を整理し、最低1つの共有ステージング環境を準備。 |
| リスクスパイク | ロイヤルティ計算、AIマッチング、WFリアルタイム連携など、**Directus拡張で厳しそうな領域**を先にPoC。 |

### 成果物

| 成果物 | 内容 |
|--------|------|
| アーキテクチャドキュメント | SSO方式、マナの扱い、データ所有境界などの決定事項を明文化。 |
| ドメインモデル図 | 主要エンティティと関連図。 |
| 2年スコープ合意書（ラフ） | 「必ずやるもの」「やらないもの」「将来候補」を分けた一覧。 |
| スパイク結果メモ | Directus拡張やリアルタイム構成の可否・制約の整理。 |

---

## フェーズ1（3〜9ヶ月）：共通基盤・SSO・WF MVP構築

### フェーズ1 サマリー

| 項目 | 内容 |
|------|------|
| 期間 | 3〜9ヶ月 |
| 主目的 | **SSOとWFブース申請MVP**を本番で使えるレベルまで持っていく。マナの基本実装も開始。 |
| 成果イメージ | ユーザーは1回ログインでIPGO/OPEを行き来し、WFブース申請・状況確認ができる。最小限のマナと通知も動作。 |

### 優先機能（実装範囲）

| # | 機能 | フェーズ1範囲 |
|---|------|----------------|
| 1 | バグ修正 & UX改善 | 認証、ナビゲーション、WF関連フォーム・画面に集中。 |
| 2 | 安定したSSO + ロール切替 | IP Owner / Creator / Fan を横断した安定SSOとロール切替を本番投入。 |
| 3 | 統合ダッシュボード | ロール別にWF関連カード（申請状況、簡易統計など）を表示する v1。 |
| 5 | 通知システム | WFブース申請の受付・承認/却下・重要アナウンスを対象にした最小通知。 |
| 36 | マナシステム | 限定された行動（例: プロフィール完了、WF申請など）に対するマナ付与と表示。 |
| 41 | WFブース申請システム | 個人/法人向けの申請フォーム、バリデーション、審査ステータス管理。 |
| 43 | WF専用タブ・ラベル | 関連画面にWFタブやバッジを追加し、ユーザーがWF機能を見つけやすくする。 |

### 技術的フォーカス

| 領域 | 詳細 |
|------|------|
| SSO & Identity 実装 | 選定したSSO方式の実装、セッション管理、ロール切替UI/バックエンド処理の安定化。 |
| WFデータモデル | Event / Booth / BoothApplication / Exhibitor の実装とAPI化。 |
| UX & 安定性 | 認証・WF申請フォームのエラー表示改善、致命的なナビゲーション問題の解消。 |
| 通知実装 | 共通通知モデル + UI + 重要メール（WF関連）の実装。 |

### 成果物

| 成果物 | 内容 |
|--------|------|
| クロスサイトSSO | IPGO / OPE 間でのシングルサインオンと安定したロール切替。 |
| 統合ダッシュボード v1 | WFにフォーカスしたシンプルなトップ画面。 |
| WFブース申請MVP | 申請〜審査〜結果通知までの一連のフロー。 |
| マナ v1 | 少数のアクションに紐づいたマナ付与と残高表示。 |
| WF通知 | WF関連イベントに対するアプリ内・メール通知。 |

---

## フェーズ2（9〜15ヶ月）：WF/EXPO現場運用 & リアルタイム機能

### フェーズ2 サマリー

| 項目 | 内容 |
|------|------|
| 期間 | 9〜15ヶ月 |
| 主目的 | WF/EXPO 会場での**リアル運用**を支える：ブースマップ、会場決済、売上同期、会場マナ付与。 |
| 成果イメージ | WFクラスのイベントを、ブース・決済・売上可視化・マナ付与まで一通り支えられる状態。 |

### 優先機能（実装範囲）

| # | 機能 | フェーズ2範囲 |
|---|------|----------------|
| 44 | リアルタイムブースマップ | EXPOアプリ側でブース位置・ステータスを表示。頻度高めのポーリング or 軽めのリアルタイム。 |
| 45 | 会場決済 & 購入同期 | 会場での決済処理を統合し、売上をバックエンドへ同期。オフライン耐性も考慮。 |
| 46 | WF売上レポート | IPオーナー向けのWF売上ダッシュボード（数量・売上・時間推移などの基本指標）。 |
| 47 | 会場マナ付与 | ブース訪問・購入・投票などの会場アクティビティに応じたマナ付与。 |
| 4 | サイト横断リアルタイム同期 | WF関係（ブース・商品・売上・イベントアクション）に範囲を限定したリアルタイム/準リアルタイム同期。 |
| 5 | 通知システム拡張 | 在庫警告、売上マイルストーン、スケジュール変更などのイベント時通知。 |

### 技術的フォーカス

| 領域 | 詳細 |
|------|------|
| リアルタイム/準リアルタイム | WebSocket / SSE / ポーリングのどれか、インフラと負荷に合う方式を選択。イベントの冪等処理を設計。 |
| オフライン耐性 | EXPOアプリ側でローカルキャッシュ・遅延同期を行い、会場の回線不安定さに耐える。 |
| イベント監視 | ブースマップ更新・決済エラー・同期遅延などを検知できる最低限の監視/ログを導入。 |
| データ一貫性 | 二重計上・二重課金を防ぐためのID設計や再送処理の戦略。 |

### 成果物

| 成果物 | 内容 |
|--------|------|
| WFブースマップ | EXPOアプリでのライブ感あるブースマップ表示。 |
| 会場決済 + 同期 | 会場決済からバックエンドへの信頼できるデータ同期。 |
| 売上ダッシュボード v1 | WF売上の基本的な可視化。 |
| 会場マナ v1.1 | 会場アクションに連動したマナシステム。 |
| WF運用プレイブック | 本番イベント運用のための手順書（監視・手動対応・ロールバック方針など）。 |

---

## フェーズ3（15〜21ヶ月）：収益化機能 & プロダクションレディ化の一部

### フェーズ3 サマリー

| 項目 | 内容 |
|------|------|
| 期間 | 15〜21ヶ月 |
| 主目的 | WF特化から一歩進めて、**継続的なEC/収益化**をサポートしつつ、重要なプロダクション要素を整える。 |
| 成果イメージ | クリエイター/IPオーナーが簡易ストアを運営し、売上・ロイヤルティを把握できる。重要なセキュリティ・監視・CI/CDが整う。 |

### 優先機能（実装範囲）

| # | 機能 | フェーズ3範囲 |
|---|------|----------------|
| 22 | デジタル/物理ストア | 対応パターンを絞ったストア v1（少数の商品タイプとシンプルな配送）。 |
| 23 | 受注・配送管理 | ステータス（注文受付→発送→完了）と簡易な配送情報管理・エクスポート。 |
| 30 | 収益ダッシュボード | WF + ストア売上を中心とした収益可視化。 |
| 15 | ロイヤルティ計算エンジン | 代表的な契約テンプレートに限定したシンプル計算。 |
| 16 | マルチ通貨決済・清算 | 優先通貨のみ対応し、正しい計上とレポートに集中。 |
| 25/26 | スポンサープラン or クラファン | 実需要に合わせてどちらか一方だけ実装。 |

### プロダクションレディ要素（M項目）

| # | コンポーネント | フェーズ3範囲 |
|---|---------------|----------------|
| M2 | レート制限・ブルートフォース防御・2FA | 認証・管理系エンドポイントに導入。重要アカウント向けに2FA提供。 |
| M3 | 監視 & ロギング | WF + 決済/ストア系フローを中心にログ・エラートラッキング・基本ダッシュボードを整備。 |
| M4 | CI/CD + 自動テスト | 認証・決済・WF売上同期・ストアチェックアウトのスモークテストを含むパイプライン。 |
| M8 | トランザクションメール | パスワードリセット、領収メール、WF関連通知などの安定配信。 |

### 技術的フォーカス

| 領域 | 詳細 |
|------|------|
| 金融的正確性 | 決済ゲートウェイとのコールバック・リトライ・返金などを考慮した台帳と照合処理。 |
| セキュリティ強化 | レート制限、ロックアウト、2FA、ログによる不審行動検知。 |
| 自動化 | デプロイと重要フローの自動テストで、少人数でも安全にリリースできる体制。 |
| 将来スケール | メトリクスとログをもとに、ボトルネック・リライト必要箇所を把握できる状態。 |

### 成果物

| 成果物 | 内容 |
|--------|------|
| ストア v1 | 絞り込まれた商品パターンを扱えるEC機能。 |
| フルフィルメント v1 | 最低限の受注〜発送管理。 |
| 収益 & ロイヤルティ v1 | 基本的な売上・ロイヤルティダッシュボードと清算処理。 |
| セキュリティ & CI/CD基盤 | レート制限・2FA・監視・クリティカルパスの自動テスト。 |
| メール基盤 | 重要通知の安定配信とモニタリング。 |

---

## フェーズ4（21〜24ヶ月）：高度機能の一部 & さらなるプロダクションレディ化

### フェーズ4 サマリー

| 項目 | 内容 |
|------|------|
| 期間 | 21〜24ヶ月 |
| 主目的 | 実際の利用データをもとに、**コミュニティ/AI/アナリティクス**の中から優先度の高いものを選び実装。運用面も強化。 |
| 成果イメージ | コア機能が安定しつつ、1〜2個の「尖った機能」で差別化。バックアップ・DR・負荷試験が形になる。 |

### 候補となる高度機能（実データで優先度を決定）

| # | 機能群 | フェーズ4範囲（候補） |
|---|--------|-------------------------|
| 32 | パーソナライズドフィード | フォローしているクリエイター、WF/イベント、ストア商品に絞ったシンプルなフィード。 |
| 34 | コミュニティ機能 | 限定されたコンテンツ種別に対するコメント/いいね/フォロー + モデレーション。 |
| 19 | AIクリエイター/ブランドマッチング | WF or 特定ジャンルに絞ったマッチングMVP。 |
| 20 | IPアナリティクス | 売上・エンゲージメント・イベント成績などの基本指標ダッシュボード。 |

### プロダクションレディ要素（継続）

| # | コンポーネント | フェーズ4範囲 |
|---|---------------|----------------|
| M1 | 管理画面 + インパーソネーション | WF運用・決済サポートに必要な範囲を優先実装。 |
| M6 | 性能 & 負荷試験 | WFマップ・売上ダッシュボード・ストア・認証などに対するロードテスト。 |
| M7 | バックアップ & DR | 自動バックアップ、リストア手順書、少なくとも1回のDR訓練。 |
| M9 | KYC / 年齢確認 | 法的要件が明確になった場合のみ優先実装。 |
| M10 | カスタマーサポート連携 | チケット or チャットツール連携。 |
| M11 | オンボーディングフロー | IPオーナー・クリエイター・ファンごとの簡易オンボーディング。 |

### 技術的フォーカス

| 領域 | 詳細 |
|------|------|
| データ駆動の優先順位 | 利用ログ・サポート問い合わせ・ビジネス要件から「一番効く高度機能」を選ぶ。 |
| 性能 & 耐障害性 | WF規模の負荷での挙動確認とチューニング。障害シナリオ（DB停止など）の演習。 |
| 運用成熟度 | バックアップ/復旧手順・インシデント対応手順の整備。 |

### 成果物

| 成果物 | 内容 |
|--------|------|
| 高度機能 v1 | コミュニティ / パーソナライズ / AI / アナリティクスのうち1〜2個。 |
| 管理 & サポートツール | インパーソネーション付きのサポート向け管理UI。 |
| DR & 負荷試験プラクティス | バックアップ・復旧・負荷試験の実行結果と改善済みシステム。 |
| オンボーディング & サポート導線 | 新規ユーザーが迷わない導線とサポートへの接続。 |

---

## 横断的なプラクティス（全フェーズ共通）

| 項目 | 方針 |
|------|------|
| スコープの薄切り | すべての機能を「MVP → v1.1 → v1.2…」と細かく出していく。大型機能を一気に作らない。 |
| リライトチェックポイント | フェーズ2・4の終わりに Directus/Spring Boot の複雑度を再評価し、必要なら次の2〜3年計画でリライトフェーズを設ける。 |
| リスク管理 | 常にトップ5リスク（技術・法務・運用）を明示し、フェーズごとに見直す。 |
| 法務・コンプライアンス | GDPR / 日本・韓国の個人情報・紛争などの重い領域は、専門家の最低限のレビューを得てから着手する。 |

---

## 高レベル実行タスク（TODOラフ）

| ID | タスク | 依存関係 |
|----|--------|----------|
| phase0-align-architecture | 2年WF優先スコープの確定、コアドメインモデルとSSO/マナアーキテクチャ決定。 | – |
| phase1-implement-sso-wf-mvp | SSO・統合ダッシュボードv1・WFブース申請MVP・WFラベル・最小マナ/通知の実装。 | phase0-align-architecture |
| phase2-wf-realtime-ops | WFブースマップ、会場決済+同期、売上ダッシュボード、会場マナ付与の実装。 | phase1-implement-sso-wf-mvp |
| phase3-monetization-hardening | ストア・フルフィルメント・収益ダッシュボード・簡易ロイヤルティ/多通貨清算・セキュリティ/監視/CIの整備。 | phase2-wf-realtime-ops |
| phase4-advanced-features-prod | 高度機能（コミュニティ/AI/アナリティクスの一部）とバックアップ・DR・性能試験の強化。 | phase3-monetization-hardening |